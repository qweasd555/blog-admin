var C=(S,_,l)=>new Promise((y,m)=>{var i=c=>{try{f(l.next(c))}catch(v){m(v)}},x=c=>{try{f(l.throw(c))}catch(v){m(v)}},f=c=>c.done?y(c.value):Promise.resolve(c.value).then(i,x);f((l=l.apply(S,_)).next())});import{s as b}from"./supabase-6fa7b02d.js";import{_ as P}from"./_plugin-vue_export-helper-c27b6911.js";import{P as d,Q as B,R as D}from"./element-plus-ec987f8a.js";import{r as g,c as V,j as U,a8 as r,ac as A,m as E,q as F,t as u,H as a,B as n,F as h,C as H,A as K}from"./vue-vendor-003ac6f9.js";import"./index-e40cfe8c.js";const O={class:"comments-management"},Q={class:"search-actions"},G={class:"action-buttons"},J={class:"pagination"},W={__name:"Comments",setup(S){const _=g(!1),l=g(""),y=g(1),m=g(10),i=g([]),x=V(()=>i.value.length),f=V(()=>{let t=i.value;if(l.value){const e=l.value.toLowerCase();t=t.filter(o=>o.content.toLowerCase().includes(e)||o.author.toLowerCase().includes(e)||o.post_title.toLowerCase().includes(e))}return t}),c=t=>new Date(t).toLocaleString("zh-CN"),v=()=>C(this,null,function*(){try{_.value=!0,console.log("ðŸ” å¼€å§‹è¿žæŽ¥Supabaseæ•°æ®åº“èŽ·å–è¯„è®ºæ•°æ®...");const{data:t,error:e}=yield b.from("comments").select("*").order("created_at",{ascending:!1});if(e){console.error("âŒ èŽ·å–è¯„è®ºæ•°æ®å¤±è´¥:",e),d.error(`èŽ·å–è¯„è®ºæ•°æ®å¤±è´¥: ${e.message}`);try{const{data:o,error:w}=yield b.from("comments").select("id").limit(1);w&&d.warning("è¯„è®ºè¡¨å¯èƒ½ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥æ•°æ®åº“è¡¨ç»“æž„")}catch(o){console.error("æµ‹è¯•è¿žæŽ¥å¤±è´¥:",o)}return}console.log("âœ… æˆåŠŸèŽ·å–è¯„è®ºæ•°æ®:",t),i.value=t.map(o=>({id:o.id,content:o.content||"æ— å†…å®¹",author:o.author_name||"åŒ¿åç”¨æˆ·",post_title:"å…³è”æ–‡ç« ",created_at:o.created_at||new Date().toISOString(),status:"approved"})),d.success(`æˆåŠŸåŠ è½½ ${i.value.length} æ¡è¯„è®º`)}catch(t){console.error("åŠ è½½è¯„è®ºæ•°æ®å¤±è´¥:",t),d.error("åŠ è½½è¯„è®ºæ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®åº“è¿žæŽ¥")}finally{_.value=!1}}),L=t=>C(this,null,function*(){try{yield D.confirm(`ç¡®å®šè¦${t.status==="approved"?"æ‹’ç»":"é€šè¿‡"}è¯„è®ºå—ï¼Ÿ`,"æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});const{error:e}=yield b.from("comments").update({status:t.status==="approved"?"rejected":"approved"}).eq("id",t.id);if(e){d.error("æ›´æ–°è¯„è®ºçŠ¶æ€å¤±è´¥: "+e.message);return}t.status=t.status==="approved"?"rejected":"approved",d.success("æ“ä½œæˆåŠŸ")}catch(e){}}),T=t=>C(this,null,function*(){try{yield D.confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿ","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});const{error:e}=yield b.from("comments").delete().eq("id",t.id);if(e){d.error("åˆ é™¤è¯„è®ºå¤±è´¥: "+e.message);return}i.value=i.value.filter(o=>o.id!==t.id),d.success("åˆ é™¤æˆåŠŸ")}catch(e){}});return U(()=>{v()}),(t,e)=>{const o=r("Search"),w=r("el-icon"),$=r("el-input"),j=r("Refresh"),k=r("el-button"),z=r("el-card"),p=r("el-table-column"),N=r("el-tag"),R=r("el-table"),q=r("el-pagination"),I=A("loading");return E(),F("div",O,[e[5]||(e[5]=u("div",{class:"page-header"},[u("h2",null,"è¯„è®ºç®¡ç†"),u("p",null,"ç®¡ç†ç³»ç»Ÿè¯„è®ºå†…å®¹")],-1)),a(z,{class:"search-bar"},{default:n(()=>[u("div",Q,[a($,{modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=s=>l.value=s),placeholder:"æœç´¢è¯„è®ºå†…å®¹",style:{width:"300px"},clearable:""},{prefix:n(()=>[a(w,null,{default:n(()=>[a(o)]),_:1})]),_:1},8,["modelValue"]),u("div",G,[a(k,{type:"primary",onClick:t.handleRefresh},{default:n(()=>[a(w,null,{default:n(()=>[a(j)]),_:1}),e[3]||(e[3]=h(" åˆ·æ–° ",-1))]),_:1},8,["onClick"])])])]),_:1}),a(z,null,{default:n(()=>[H((E(),K(R,{data:f.value,style:{width:"100%"}},{default:n(()=>[a(p,{prop:"id",label:"ID",width:"80"}),a(p,{prop:"content",label:"è¯„è®ºå†…å®¹"}),a(p,{prop:"author",label:"è¯„è®ºç”¨æˆ·",width:"120"}),a(p,{prop:"post_title",label:"æ‰€å±žæ–‡ç« "}),a(p,{prop:"created_at",label:"è¯„è®ºæ—¶é—´",width:"180"},{default:n(({row:s})=>[h(B(c(s.created_at)),1)]),_:1}),a(p,{prop:"status",label:"çŠ¶æ€",width:"100"},{default:n(({row:s})=>[a(N,{type:s.status==="approved"?"success":"warning"},{default:n(()=>[h(B(s.status==="approved"?"å·²å®¡æ ¸":"å¾…å®¡æ ¸"),1)]),_:2},1032,["type"])]),_:1}),a(p,{label:"æ“ä½œ",width:"200"},{default:n(({row:s})=>[a(k,{size:"small",type:s.status==="approved"?"warning":"success",onClick:M=>L(s)},{default:n(()=>[h(B(s.status==="approved"?"å–æ¶ˆå®¡æ ¸":"é€šè¿‡å®¡æ ¸"),1)]),_:2},1032,["type","onClick"]),a(k,{size:"small",type:"danger",onClick:M=>T(s)},{default:n(()=>[...e[4]||(e[4]=[h(" åˆ é™¤ ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[I,_.value]]),u("div",J,[a(q,{"current-page":y.value,"onUpdate:currentPage":e[1]||(e[1]=s=>y.value=s),"page-size":m.value,"onUpdate:pageSize":e[2]||(e[2]=s=>m.value=s),"page-sizes":[10,20,50,100],total:x.value,layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])]),_:1})])}}},oe=P(W,[["__scopeId","data-v-d7ea0911"]]);export{oe as default};
