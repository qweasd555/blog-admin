var P=(x,f,n)=>new Promise((u,v)=>{var C=r=>{try{g(n.next(r))}catch(w){v(w)}},i=r=>{try{g(n.throw(r))}catch(w){v(w)}},g=r=>r.done?u(r.value):Promise.resolve(r.value).then(C,i);g((n=n.apply(x,f)).next())});import{aj as q,r as y,c as B,j as A,a8 as c,ac as F,m as D,q as H,t as p,H as t,B as s,u as V,F as _,C as K,A as O}from"./vue-vendor-003ac6f9.js";import{P as m,Q,R as G,S as J,T as W}from"./element-plus-ec987f8a.js";import{s as k}from"./supabase-6fa7b02d.js";import{_ as X}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-e40cfe8c.js";const Y={class:"posts-management"},Z={class:"search-actions"},ee={class:"action-buttons"},te={class:"pagination"},ae={__name:"Posts",setup(x){const f=q(),n=y(!1),u=y(""),v=y(1),C=y(10),i=y([]),g=B(()=>i.value.length),r=B(()=>{let a=i.value;if(u.value){const e=u.value.toLowerCase();a=a.filter(o=>o.title.toLowerCase().includes(e)||o.author.toLowerCase().includes(e))}return a}),w=a=>new Date(a).toLocaleString("zh-CN"),E=()=>{f.push("/posts/edit")},L=a=>{f.push(`/posts/detail/${a.id}`)},N=a=>{f.push(`/posts/edit/${a.id}`)},T=a=>P(this,null,function*(){try{yield G.confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ç«  "${a.title}" å—ï¼Ÿ`,"æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});const{error:e}=yield k.from("posts").delete().eq("id",a.id);if(e)throw e;i.value=i.value.filter(o=>o.id!==a.id),m.success("åˆ é™¤æˆåŠŸ")}catch(e){console.error("åˆ é™¤æ–‡ç« å¤±è´¥:",e),m.error(`åˆ é™¤æ–‡ç« å¤±è´¥: ${e.message}`)}}),z=()=>P(this,null,function*(){try{n.value=!0,console.log("ðŸ” å¼€å§‹è¿žæŽ¥Supabaseæ•°æ®åº“èŽ·å–æ–‡ç« æ•°æ®...");const{data:a,error:e}=yield k.from("posts").select("*").order("created_at",{ascending:!1});if(e){console.error("âŒ èŽ·å–æ–‡ç« æ•°æ®å¤±è´¥:",e),m.error(`èŽ·å–æ–‡ç« æ•°æ®å¤±è´¥: ${e.message}`);try{const{data:o,error:h}=yield k.from("posts").select("id").limit(1);h&&m.warning("æ–‡ç« è¡¨å¯èƒ½ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥æ•°æ®åº“è¡¨ç»“æž„")}catch(o){console.error("æµ‹è¯•è¿žæŽ¥å¤±è´¥:",o)}return}console.log("âœ… æˆåŠŸèŽ·å–æ–‡ç« æ•°æ®:",a),i.value=a.map(o=>({id:o.id,title:o.title||"æ— æ ‡é¢˜",author:o.username||o.author||o.author_name||"åŒ¿åä½œè€…",created_at:o.created_at||new Date().toISOString(),views:o.views||0})),m.success(`æˆåŠŸåŠ è½½ ${i.value.length} ç¯‡æ–‡ç« `)}catch(a){console.error("åŠ è½½æ–‡ç« æ•°æ®å¤±è´¥:",a),m.error("åŠ è½½æ–‡ç« æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®åº“è¿žæŽ¥")}finally{n.value=!1}}),j=()=>{z()};return A(()=>{z()}),(a,e)=>{const o=c("Search"),h=c("el-icon"),I=c("el-input"),b=c("el-button"),S=c("el-card"),d=c("el-table-column"),M=c("el-table"),R=c("el-pagination"),U=F("loading");return D(),H("div",Y,[e[8]||(e[8]=p("div",{class:"page-header"},[p("h2",null,"æ–‡ç« ç®¡ç†"),p("p",null,"ç®¡ç†ç³»ç»Ÿæ–‡ç« å†…å®¹")],-1)),t(S,{class:"search-bar"},{default:s(()=>[p("div",Z,[t(I,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=l=>u.value=l),placeholder:"æœç´¢æ–‡ç« æ ‡é¢˜",style:{width:"300px"},clearable:""},{prefix:s(()=>[t(h,null,{default:s(()=>[t(o)]),_:1})]),_:1},8,["modelValue"]),p("div",ee,[t(b,{type:"primary",onClick:E},{default:s(()=>[t(h,null,{default:s(()=>[t(V(J))]),_:1}),e[3]||(e[3]=_(" æ–°å»ºæ–‡ç«  ",-1))]),_:1}),t(b,{onClick:j},{default:s(()=>[t(h,null,{default:s(()=>[t(V(W))]),_:1}),e[4]||(e[4]=_(" åˆ·æ–° ",-1))]),_:1})])])]),_:1}),t(S,null,{default:s(()=>[K((D(),O(M,{data:r.value,style:{width:"100%"}},{default:s(()=>[t(d,{prop:"id",label:"ID",width:"80"}),t(d,{prop:"title",label:"æ ‡é¢˜"}),t(d,{prop:"author",label:"ä½œè€…",width:"120"}),t(d,{prop:"created_at",label:"å‘å¸ƒæ—¶é—´",width:"180"},{default:s(({row:l})=>[_(Q(w(l.created_at)),1)]),_:1}),t(d,{prop:"views",label:"æ–‡ç« ç‚¹èµžé‡",width:"100"}),t(d,{label:"æ“ä½œ",width:"200"},{default:s(({row:l})=>[t(b,{size:"small",onClick:$=>L(l)},{default:s(()=>[...e[5]||(e[5]=[_(" æŸ¥çœ‹ ",-1)])]),_:1},8,["onClick"]),t(b,{size:"small",type:"warning",onClick:$=>N(l)},{default:s(()=>[...e[6]||(e[6]=[_(" ç¼–è¾‘ ",-1)])]),_:1},8,["onClick"]),t(b,{size:"small",type:"danger",onClick:$=>T(l)},{default:s(()=>[...e[7]||(e[7]=[_(" åˆ é™¤ ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[U,n.value]]),p("div",te,[t(R,{"current-page":v.value,"onUpdate:currentPage":e[1]||(e[1]=l=>v.value=l),"page-size":C.value,"onUpdate:pageSize":e[2]||(e[2]=l=>C.value=l),"page-sizes":[10,20,50,100],total:g.value,layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])]),_:1})])}}},ce=X(ae,[["__scopeId","data-v-b25773b0"]]);export{ce as default};
