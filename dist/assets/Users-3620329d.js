var C=(D,v,r)=>new Promise((b,g)=>{var o=i=>{try{w(r.next(i))}catch(h){g(h)}},x=i=>{try{w(r.throw(i))}catch(h){g(h)}},w=i=>i.done?b(i.value):Promise.resolve(i.value).then(o,x);w((r=r.apply(D,v)).next())});import{s as B}from"./supabase-6fa7b02d.js";import{_ as A}from"./_plugin-vue_export-helper-c27b6911.js";import{P as m,Q as M,R as O}from"./element-plus-ec987f8a.js";import{r as y,c as V,j as P,a8 as c,ac as T,m as $,q as j,t as f,H as t,B as l,F as S,C as F,A as H}from"./vue-vendor-003ac6f9.js";import"./index-e40cfe8c.js";const K={class:"users-management"},Q={class:"search-actions"},G={class:"action-buttons"},J={class:"pagination"},W={__name:"Users",setup(D){const v=y(!1),r=y(""),b=y(1),g=y(10),o=y([]),x=V(()=>o.value.length),w=V(()=>{let n=o.value;if(r.value){const e=r.value.toLowerCase();n=n.filter(a=>a.username.toLowerCase().includes(e)||a.nickname.toLowerCase().includes(e)||a.email.toLowerCase().includes(e))}return n}),i=n=>new Date(n).toLocaleString("zh-CN"),h=n=>{m.info(`æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…: ${n.nickname}`)},U=()=>C(this,null,function*(){try{v.value=!0,console.log("ðŸ” å¼€å§‹è¿žæŽ¥æ•°æ®åº“èŽ·å–çœŸå®žç”¨æˆ·æ•°æ®...");const{data:n,error:e}=yield B.from("profiles").select("id, username, email, nickname, avatar_url, created_at").order("created_at",{ascending:!1});if(e){console.error("âŒ èŽ·å–ç”¨æˆ·æ•°æ®å¤±è´¥:",e);try{const{data:a}=yield B.from("posts").select("author_name").order("created_at",{ascending:!1}).limit(20);if(a&&a.length>0){const u=[...new Set(a.map(d=>d.author_name).filter(Boolean))].map((d,_)=>({id:_+1,username:d,nickname:d,email:d+"@example.com",created_at:new Date(Date.now()-_*24*60*60*1e3).toISOString()}));u.unshift({id:"admin",username:"admin",nickname:"ç®¡ç†å‘˜",email:"admin@example.com",created_at:new Date().toISOString()}),o.value=u,m.info(`ç”¨æˆ·æ•°æ®æ¥æºäºŽæ–‡ç« ä½œè€…ä¿¡æ¯ï¼Œå…± ${o.value.length} ä¸ªç”¨æˆ·`)}else m.error("æœªæ‰¾åˆ°ç”¨æˆ·æ•°æ®ï¼Œè¯·å…ˆåœ¨æ•°æ®åº“ä¸­åˆ›å»ºprofilesè¡¨"),o.value=[]}catch(a){console.error("å¤‡é€‰æ–¹æ¡ˆä¹Ÿå¤±è´¥:",a),m.error("æ— æ³•èŽ·å–ç”¨æˆ·æ•°æ®ï¼Œè¯·æ£€æŸ¥æ•°æ®åº“è¿žæŽ¥å’Œè¡¨ç»“æž„"),o.value=[]}return}console.log("âœ… æˆåŠŸèŽ·å–çœŸå®žç”¨æˆ·æ•°æ®:",n),o.value=n.map(a=>{var p,u;return{id:a.id,username:a.username||a.nickname||((p=a.email)==null?void 0:p.split("@")[0])||"æœªçŸ¥ç”¨æˆ·",nickname:a.nickname||a.username||((u=a.email)==null?void 0:u.split("@")[0])||"æœªçŸ¥ç”¨æˆ·",email:a.email||"æ— é‚®ç®±",created_at:a.created_at||new Date().toISOString()}}),m.success(`æˆåŠŸåŠ è½½ ${o.value.length} ä¸ªçœŸå®žç”¨æˆ·`)}catch(n){console.error("åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:",n),m.error("åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®åº“è¿žæŽ¥"),o.value=[]}finally{v.value=!1}}),I=n=>C(this,null,function*(){try{yield O.confirm(`ç¡®å®šè¦ç¦ç”¨ç”¨æˆ· "${n.nickname}" å—ï¼Ÿ`,"æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),m.info("ç”¨æˆ·ç¦ç”¨åŠŸèƒ½ï¼ˆæ¨¡æ‹Ÿæ“ä½œï¼‰")}catch(e){}}),L=()=>{U()};return P(()=>{U()}),(n,e)=>{const a=c("Search"),p=c("el-icon"),u=c("el-input"),d=c("Refresh"),_=c("el-button"),z=c("el-card"),k=c("el-table-column"),E=c("el-table"),N=c("el-pagination"),R=T("loading");return $(),j("div",K,[e[6]||(e[6]=f("div",{class:"page-header"},[f("h2",null,"ç”¨æˆ·ç®¡ç†"),f("p",null,"ç®¡ç†ç³»ç»Ÿç”¨æˆ·å’Œæƒé™")],-1)),t(z,{class:"search-bar"},{default:l(()=>[f("div",Q,[t(u,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=s=>r.value=s),placeholder:"æœç´¢ç”¨æˆ·åã€é‚®ç®±",style:{width:"300px"},clearable:""},{prefix:l(()=>[t(p,null,{default:l(()=>[t(a)]),_:1})]),_:1},8,["modelValue"]),f("div",G,[t(_,{type:"primary",onClick:L},{default:l(()=>[t(p,null,{default:l(()=>[t(d)]),_:1}),e[3]||(e[3]=S(" åˆ·æ–° ",-1))]),_:1})])])]),_:1}),t(z,null,{default:l(()=>[F(($(),H(E,{data:w.value,style:{width:"100%"}},{default:l(()=>[t(k,{prop:"id",label:"ID",width:"80"}),t(k,{prop:"username",label:"ç”¨æˆ·å"}),t(k,{prop:"email",label:"é‚®ç®±"}),t(k,{prop:"created_at",label:"æ³¨å†Œæ—¶é—´",width:"180"},{default:l(({row:s})=>[S(M(i(s.created_at)),1)]),_:1}),t(k,{label:"æ“ä½œ",width:"150"},{default:l(({row:s})=>[t(_,{size:"small",type:"danger",onClick:q=>I(s)},{default:l(()=>[...e[4]||(e[4]=[S(" ç¦ç”¨ ",-1)])]),_:1},8,["onClick"]),t(_,{size:"small",type:"warning",onClick:q=>h(s)},{default:l(()=>[...e[5]||(e[5]=[S(" è¯¦æƒ… ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[R,v.value]]),f("div",J,[t(N,{"current-page":b.value,"onUpdate:currentPage":e[1]||(e[1]=s=>b.value=s),"page-size":g.value,"onUpdate:pageSize":e[2]||(e[2]=s=>g.value=s),"page-sizes":[10,20,50,100],total:x.value,layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])]),_:1})])}}},ne=A(W,[["__scopeId","data-v-262b2042"]]);export{ne as default};
