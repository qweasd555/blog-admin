import{_ as k,s as p}from"./_plugin-vue_export-helper-b60847f6.js";import{r as g,g as N,b as i,o as x,c as E,d as e,e as s,w as a,E as C,t as y,f as h}from"./index-108f509c.js";const P={class:"dashboard"},S={class:"stats-grid"},M={class:"stat-content"},B={class:"stat-icon user-icon"},T={class:"stat-info"},V={class:"stat-value"},z={class:"stat-content"},A={class:"stat-icon post-icon"},I={class:"stat-info"},L={class:"stat-value"},R={class:"stat-content"},q={class:"stat-icon comment-icon"},O={class:"stat-info"},j={class:"stat-value"},F={class:"stat-content"},G={class:"stat-icon today-icon"},H={class:"stat-info"},J={class:"stat-value"},K={class:"action-buttons"},Q={__name:"Dashboard",setup(W){const r=g({totalUsers:0,totalPosts:0,totalComments:0,todayUsers:0}),_=g([]),w=c=>({用户:"success",文章:"primary",评论:"warning"})[c]||"info",D=async()=>{try{let c=0;const t=["profiles","users","user"];for(const o of t)try{const{count:l,error:n}=await p.from(o).select("*",{count:"exact",head:!0});if(!n&&l){c=l,console.log(`✅ 从表 ${o} 获取到用户数据: ${l}`);break}}catch{console.log(`❌ 表 ${o} 不存在或查询失败`)}r.value.totalUsers=c;let m=0;try{const{count:o,error:l}=await p.from("posts").select("*",{count:"exact",head:!0});l||(m=o||0)}catch{console.log("文章表不存在")}r.value.totalPosts=m;let d=0;try{const{count:o,error:l}=await p.from("comments").select("*",{count:"exact",head:!0});l||(d=o||0)}catch{console.log("评论表不存在")}r.value.totalComments=d;const u=new Date().toISOString().split("T")[0];let v=0;for(const o of t)try{const{count:l,error:n}=await p.from(o).select("*",{count:"exact",head:!0}).gte("created_at",u);if(!n&&l){v=l;break}}catch{}r.value.todayUsers=v;try{const{data:o,error:l}=await p.from("posts").select("*").order("created_at",{ascending:!1}).limit(5);!l&&o&&o.forEach(n=>{_.value.push({type:"文章",description:`文章 "${n.title}" 发布`,time:new Date(n.created_at).toLocaleString("zh-CN")})})}catch{console.log("无法获取最近文章")}try{const{data:o,error:l}=await p.from("comments").select("*").order("created_at",{ascending:!1}).limit(5);!l&&o&&o.forEach(n=>{_.value.push({type:"评论",description:"用户发表了新评论",time:new Date(n.created_at).toLocaleString("zh-CN")})})}catch{console.log("无法获取最近评论")}_.value.sort((o,l)=>new Date(l.time)-new Date(o.time)),_.value=_.value.slice(0,4),r.value.totalUsers===0&&r.value.totalPosts===0&&r.value.totalComments===0&&C.warning("数据库中没有找到数据，请检查数据库表结构")}catch(c){console.error("加载数据失败:",c),C.error("数据加载失败，请检查数据库连接")}};return N(()=>{D()}),(c,t)=>{const m=i("User"),d=i("el-icon"),u=i("el-card"),v=i("Document"),o=i("ChatDotRound"),l=i("Calendar"),n=i("el-button"),U=i("el-tag"),b=i("el-table-column"),$=i("el-table");return x(),E("div",P,[t[12]||(t[12]=e("div",{class:"dashboard-header"},[e("h2",null,"仪表盘"),e("p",null,"系统概览和统计数据")],-1)),e("div",S,[s(u,{class:"stat-card"},{default:a(()=>[e("div",M,[e("div",B,[s(d,null,{default:a(()=>[s(m)]),_:1})]),e("div",T,[e("div",V,y(r.value.totalUsers),1),t[3]||(t[3]=e("div",{class:"stat-label"},"总用户数",-1))])])]),_:1}),s(u,{class:"stat-card"},{default:a(()=>[e("div",z,[e("div",A,[s(d,null,{default:a(()=>[s(v)]),_:1})]),e("div",I,[e("div",L,y(r.value.totalPosts),1),t[4]||(t[4]=e("div",{class:"stat-label"},"总文章数",-1))])])]),_:1}),s(u,{class:"stat-card"},{default:a(()=>[e("div",R,[e("div",q,[s(d,null,{default:a(()=>[s(o)]),_:1})]),e("div",O,[e("div",j,y(r.value.totalComments),1),t[5]||(t[5]=e("div",{class:"stat-label"},"总评论数",-1))])])]),_:1}),s(u,{class:"stat-card"},{default:a(()=>[e("div",F,[e("div",G,[s(d,null,{default:a(()=>[s(l)]),_:1})]),e("div",H,[e("div",J,y(r.value.todayUsers),1),t[6]||(t[6]=e("div",{class:"stat-label"},"今日注册",-1))])])]),_:1})]),s(u,{class:"quick-actions"},{header:a(()=>[...t[7]||(t[7]=[e("div",{class:"card-header"},[e("span",null,"快速操作")],-1)])]),default:a(()=>[e("div",K,[s(n,{type:"primary",onClick:t[0]||(t[0]=f=>c.$router.push("/users"))},{default:a(()=>[s(d,null,{default:a(()=>[s(m)]),_:1}),t[8]||(t[8]=h(" 用户管理 ",-1))]),_:1}),s(n,{type:"primary",onClick:t[1]||(t[1]=f=>c.$router.push("/posts"))},{default:a(()=>[s(d,null,{default:a(()=>[s(v)]),_:1}),t[9]||(t[9]=h(" 文章管理 ",-1))]),_:1}),s(n,{type:"primary",onClick:t[2]||(t[2]=f=>c.$router.push("/comments"))},{default:a(()=>[s(d,null,{default:a(()=>[s(o)]),_:1}),t[10]||(t[10]=h(" 评论管理 ",-1))]),_:1})])]),_:1}),s(u,{class:"recent-activity"},{header:a(()=>[...t[11]||(t[11]=[e("div",{class:"card-header"},[e("span",null,"最近活动")],-1)])]),default:a(()=>[s($,{data:_.value,style:{width:"100%"}},{default:a(()=>[s(b,{prop:"type",label:"类型",width:"100"},{default:a(({row:f})=>[s(U,{type:w(f.type)},{default:a(()=>[h(y(f.type),1)]),_:2},1032,["type"])]),_:1}),s(b,{prop:"description",label:"描述"}),s(b,{prop:"time",label:"时间",width:"180"})]),_:1},8,["data"])]),_:1})])}}},Z=k(Q,[["__scopeId","data-v-75e0426f"]]);export{Z as default};
