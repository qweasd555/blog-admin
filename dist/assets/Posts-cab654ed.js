import{_ as U,s as x}from"./_plugin-vue_export-helper-b60847f6.js";import{r as v,h as P,g as j,b as r,i as q,o as z,c as K,d as _,e as t,w as s,E as f,f as m,j as O,k as A,t as $,l as F}from"./index-108f509c.js";const G={class:"posts-management"},H={class:"search-actions"},J={class:"action-buttons"},Q={class:"pagination"},W={__name:"Posts",setup(X){const h=v(!1),g=v(""),w=v(1),y=v(10),u=v([]),D=P(()=>u.value.length),S=P(()=>{let a=u.value;if(g.value){const e=g.value.toLowerCase();a=a.filter(i=>i.title.toLowerCase().includes(e)||i.author.toLowerCase().includes(e))}return a}),B=a=>new Date(a).toLocaleString("zh-CN"),N=a=>{f.info(`查看文章: ${a.title}`)},V=a=>{f.info(`编辑文章: ${a.title}`)},E=async a=>{try{await F.confirm(`确定要删除文章 "${a.title}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),u.value=u.value.filter(e=>e.id!==a.id),f.success("删除成功")}catch{}},k=async()=>{try{h.value=!0;const a=["posts","articles","post"];let e=[],i=!1;for(const l of a)try{let c=x.from(l).select("*").order("created_at",{ascending:!1});try{const{data:d,error:n}=await c.select(`
            *,
            profiles:author_id (username, email)
          `);if(!n&&d){e=d,i=!0,console.log(`✅ 从表 ${l} 成功加载文章数据（关联查询）`);break}}catch{const{data:n,error:b}=await x.from(l).select("*").order("created_at",{ascending:!1});if(!b&&n){e=n,i=!0,console.log(`✅ 从表 ${l} 成功加载文章数据（简单查询）`);break}}}catch(c){console.log(`❌ 表 ${l} 查询失败:`,c)}if(!i){f.warning("未找到文章数据表，请检查数据库表结构"),u.value=[];return}u.value=e.map(l=>{var c,d,n;return{id:l.id,title:l.title||"无标题",author:l.author||((c=l.profiles)==null?void 0:c.username)||((n=(d=l.profiles)==null?void 0:d.email)==null?void 0:n.split("@")[0])||"匿名作者",created_at:l.created_at||new Date().toISOString(),views:l.views||0,status:l.status||"draft"}}),f.success(`成功加载 ${u.value.length} 篇文章`)}catch(a){console.error("加载文章数据失败:",a),f.error("加载文章数据失败，请检查数据库连接")}finally{h.value=!1}},L=()=>{k()};return j(()=>{k()}),(a,e)=>{const i=r("Search"),l=r("el-icon"),c=r("el-input"),d=r("Refresh"),n=r("el-button"),b=r("el-card"),p=r("el-table-column"),T=r("el-tag"),I=r("el-table"),M=r("el-pagination"),R=q("loading");return z(),K("div",G,[e[7]||(e[7]=_("div",{class:"page-header"},[_("h2",null,"文章管理"),_("p",null,"管理系统文章内容")],-1)),t(b,{class:"search-bar"},{default:s(()=>[_("div",H,[t(c,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=o=>g.value=o),placeholder:"搜索文章标题",style:{width:"300px"},clearable:""},{prefix:s(()=>[t(l,null,{default:s(()=>[t(i)]),_:1})]),_:1},8,["modelValue"]),_("div",J,[t(n,{type:"primary",onClick:L},{default:s(()=>[t(l,null,{default:s(()=>[t(d)]),_:1}),e[3]||(e[3]=m(" 刷新 ",-1))]),_:1})])])]),_:1}),t(b,null,{default:s(()=>[O((z(),A(I,{data:S.value,style:{width:"100%"}},{default:s(()=>[t(p,{prop:"id",label:"ID",width:"80"}),t(p,{prop:"title",label:"标题"}),t(p,{prop:"author",label:"作者",width:"120"}),t(p,{prop:"created_at",label:"发布时间",width:"180"},{default:s(({row:o})=>[m($(B(o.created_at)),1)]),_:1}),t(p,{prop:"views",label:"浏览量",width:"100"}),t(p,{prop:"status",label:"状态",width:"100"},{default:s(({row:o})=>[t(T,{type:o.status==="published"?"success":"warning"},{default:s(()=>[m($(o.status==="published"?"已发布":"草稿"),1)]),_:2},1032,["type"])]),_:1}),t(p,{label:"操作",width:"200"},{default:s(({row:o})=>[t(n,{size:"small",onClick:C=>N(o)},{default:s(()=>[...e[4]||(e[4]=[m(" 查看 ",-1)])]),_:1},8,["onClick"]),t(n,{size:"small",type:"warning",onClick:C=>V(o)},{default:s(()=>[...e[5]||(e[5]=[m(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(n,{size:"small",type:"danger",onClick:C=>E(o)},{default:s(()=>[...e[6]||(e[6]=[m(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[R,h.value]]),_("div",Q,[t(M,{"current-page":w.value,"onUpdate:currentPage":e[1]||(e[1]=o=>w.value=o),"page-size":y.value,"onUpdate:pageSize":e[2]||(e[2]=o=>y.value=o),"page-sizes":[10,20,50,100],total:D.value,layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])]),_:1})])}}},ee=U(W,[["__scopeId","data-v-bd2996d6"]]);export{ee as default};
