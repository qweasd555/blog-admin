import{_ as R,s as C}from"./_plugin-vue_export-helper-b60847f6.js";import{r as _,h as U,g as j,b as o,i as P,o as z,c as q,d as u,e as a,w as n,E as d,f as m,j as K,k as O,t as y,l as A}from"./index-108f509c.js";const F={class:"users-management"},G={class:"search-actions"},H={class:"action-buttons"},J={class:"pagination"},Q={__name:"Users",setup(W){const f=_(!1),v=_(""),h=_(1),w=_(10),p=_([]),D=U(()=>p.value.length),S=U(()=>{let t=p.value;if(v.value){const e=v.value.toLowerCase();t=t.filter(r=>r.nickname.toLowerCase().includes(e)||r.email.toLowerCase().includes(e))}return t}),$=t=>new Date(t).toLocaleString("zh-CN"),B=t=>{d.info(`查看用户详情: ${t.nickname}`)},k=async()=>{try{f.value=!0;const t=["profiles","users","user"];let e=[],r=!1;for(const l of t)try{const{data:c,error:g}=await C.from(l).select("*").order("created_at",{ascending:!1});if(!g&&c){e=c,r=!0,console.log(`✅ 从表 ${l} 成功加载用户数据`);break}}catch(c){console.log(`❌ 表 ${l} 查询失败:`,c)}if(!r){d.warning("未找到用户数据表，请检查数据库表结构"),p.value=[];return}p.value=e.map(l=>{var c;return{id:l.id,nickname:l.username||l.nickname||((c=l.email)==null?void 0:c.split("@")[0])||"未知用户",email:l.email||"无邮箱",created_at:l.created_at||new Date().toISOString(),status:l.status||"active"}}),d.success(`成功加载 ${p.value.length} 个用户`)}catch(t){console.error("加载用户数据失败:",t),d.error("加载用户数据失败，请检查数据库连接")}finally{f.value=!1}},N=async t=>{try{await A.confirm(`确定要${t.status==="active"?"禁用":"启用"}用户 "${t.nickname}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const{error:e}=await C.from("profiles").update({status:t.status==="active"?"inactive":"active"}).eq("id",t.id);if(e){d.error("更新用户状态失败: "+e.message);return}t.status=t.status==="active"?"inactive":"active",d.success("操作成功")}catch{}},V=()=>{k()};return j(()=>{k()}),(t,e)=>{const r=o("Search"),l=o("el-icon"),c=o("el-input"),g=o("Refresh"),b=o("el-button"),x=o("el-card"),i=o("el-table-column"),E=o("el-tag"),L=o("el-table"),T=o("el-pagination"),I=P("loading");return z(),q("div",F,[e[5]||(e[5]=u("div",{class:"page-header"},[u("h2",null,"用户管理"),u("p",null,"管理系统用户和权限")],-1)),a(x,{class:"search-bar"},{default:n(()=>[u("div",G,[a(c,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=s=>v.value=s),placeholder:"搜索用户名、邮箱",style:{width:"300px"},clearable:""},{prefix:n(()=>[a(l,null,{default:n(()=>[a(r)]),_:1})]),_:1},8,["modelValue"]),u("div",H,[a(b,{type:"primary",onClick:V},{default:n(()=>[a(l,null,{default:n(()=>[a(g)]),_:1}),e[3]||(e[3]=m(" 刷新 ",-1))]),_:1})])])]),_:1}),a(x,null,{default:n(()=>[K((z(),O(L,{data:S.value,style:{width:"100%"}},{default:n(()=>[a(i,{prop:"id",label:"ID",width:"80"}),a(i,{prop:"nickname",label:"昵称"}),a(i,{prop:"email",label:"邮箱"}),a(i,{prop:"created_at",label:"注册时间",width:"180"},{default:n(({row:s})=>[m(y($(s.created_at)),1)]),_:1}),a(i,{prop:"status",label:"状态",width:"100"},{default:n(({row:s})=>[a(E,{type:s.status==="active"?"success":"danger"},{default:n(()=>[m(y(s.status==="active"?"活跃":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(i,{label:"操作",width:"200"},{default:n(({row:s})=>[a(b,{size:"small",type:s.status==="active"?"danger":"success",onClick:M=>N(s)},{default:n(()=>[m(y(s.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),a(b,{size:"small",type:"warning",onClick:M=>B(s)},{default:n(()=>[...e[4]||(e[4]=[m(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[I,f.value]]),u("div",J,[a(T,{"current-page":h.value,"onUpdate:currentPage":e[1]||(e[1]=s=>h.value=s),"page-size":w.value,"onUpdate:pageSize":e[2]||(e[2]=s=>w.value=s),"page-sizes":[10,20,50,100],total:D.value,layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])]),_:1})])}}},Z=R(Q,[["__scopeId","data-v-ce2959b5"]]);export{Z as default};
