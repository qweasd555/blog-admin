var E=(w,r,l)=>new Promise((g,f)=>{var c=a=>{try{u(l.next(a))}catch(n){f(n)}},t=a=>{try{u(l.throw(a))}catch(n){f(n)}},u=a=>a.done?g(a.value):Promise.resolve(a.value).then(c,t);u((l=l.apply(w,r)).next())});import{s as h}from"./supabase-6fa7b02d.js";import{_ as k}from"./_plugin-vue_export-helper-c27b6911.js";import{P as N,Q as v}from"./element-plus-ec987f8a.js";import{r as U,j as P,a8 as d,m as x,q as S,t as s,H as e,B as o,F as b}from"./vue-vendor-003ac6f9.js";import"./index-e40cfe8c.js";const B={class:"dashboard"},M={class:"stats-grid"},z={class:"stat-content"},L={class:"stat-icon user-icon"},V={class:"stat-info"},q={class:"stat-value"},A={class:"stat-content"},R={class:"stat-icon post-icon"},T={class:"stat-info"},j={class:"stat-value"},F={class:"stat-content"},H={class:"stat-icon comment-icon"},I={class:"stat-info"},Q={class:"stat-value"},G={class:"stat-content"},J={class:"stat-icon today-icon"},K={class:"stat-info"},O={class:"stat-value"},W={class:"action-buttons"},X={__name:"Dashboard",setup(w){const r=U({totalUsers:0,totalPosts:0,totalComments:0,todayUsers:0}),l=U([]),g=c=>({ç”¨æˆ·:"success",æ–‡ç« :"primary",è¯„è®º:"warning"})[c]||"info",f=()=>E(this,null,function*(){try{console.log("ğŸ” å¼€å§‹è¿æ¥Supabaseæ•°æ®åº“è·å–ç»Ÿè®¡æ•°æ®...");const{count:c,error:t}=yield h.from("posts").select("*",{count:"exact",head:!0});t?(console.error("âŒ è·å–æ–‡ç« æ€»æ•°å¤±è´¥:",t),r.value.totalPosts=0):(r.value.totalPosts=c||0,console.log("âœ… æ–‡ç« æ€»æ•°:",c));const{count:u,error:a}=yield h.from("post_comments").select("*",{count:"exact",head:!0});a?(console.error("âŒ è·å–è¯„è®ºæ€»æ•°å¤±è´¥:",a),r.value.totalComments=0):(r.value.totalComments=u||0,console.log("âœ… è¯„è®ºæ€»æ•°:",u)),r.value.totalUsers=0,r.value.todayUsers=0;const{data:n,error:_}=yield h.from("posts").select("*").order("created_at",{ascending:!1}).limit(5);!_&&n?(n.forEach(i=>{l.value.push({type:"æ–‡ç« ",description:`æ–‡ç«  "${i.title||"æ— æ ‡é¢˜"}" å‘å¸ƒ`,time:new Date(i.created_at).toLocaleString("zh-CN")})}),console.log("âœ… è·å–æœ€è¿‘æ–‡ç« æ´»åŠ¨æˆåŠŸ")):console.error("âŒ è·å–æœ€è¿‘æ–‡ç« æ´»åŠ¨å¤±è´¥:",_);const{data:p,error:y}=yield h.from("post_comments").select("*").order("created_at",{ascending:!1}).limit(5);!y&&p?(p.forEach(i=>{l.value.push({type:"è¯„è®º",description:"ç”¨æˆ·å‘è¡¨äº†æ–°è¯„è®º",time:new Date(i.created_at).toLocaleString("zh-CN")})}),console.log("âœ… è·å–æœ€è¿‘è¯„è®ºæ´»åŠ¨æˆåŠŸ")):console.error("âŒ è·å–æœ€è¿‘è¯„è®ºæ´»åŠ¨å¤±è´¥:",y),l.value.length===0&&l.value.push({type:"ç³»ç»Ÿ",description:"ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ",time:new Date().toLocaleString("zh-CN")}),l.value.sort((i,C)=>new Date(C.time)-new Date(i.time)),l.value=l.value.slice(0,4),console.log("âœ… ä»ªè¡¨ç›˜æ•°æ®åŠ è½½å®Œæˆ")}catch(c){console.error("åŠ è½½æ•°æ®å¤±è´¥:",c),N.error("æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®åº“è¿æ¥")}});return P(()=>{f()}),(c,t)=>{const u=d("User"),a=d("el-icon"),n=d("el-card"),_=d("Document"),p=d("ChatDotRound"),y=d("Calendar"),i=d("el-button"),C=d("el-tag"),D=d("el-table-column"),$=d("el-table");return x(),S("div",B,[t[12]||(t[12]=s("div",{class:"dashboard-header"},[s("h2",null,"ä»ªè¡¨ç›˜"),s("p",null,"ç³»ç»Ÿæ¦‚è§ˆå’Œç»Ÿè®¡æ•°æ®")],-1)),s("div",M,[e(n,{class:"stat-card"},{default:o(()=>[s("div",z,[s("div",L,[e(a,null,{default:o(()=>[e(u)]),_:1})]),s("div",V,[s("div",q,v(r.value.totalUsers),1),t[3]||(t[3]=s("div",{class:"stat-label"},"æ€»ç”¨æˆ·æ•°",-1))])])]),_:1}),e(n,{class:"stat-card"},{default:o(()=>[s("div",A,[s("div",R,[e(a,null,{default:o(()=>[e(_)]),_:1})]),s("div",T,[s("div",j,v(r.value.totalPosts),1),t[4]||(t[4]=s("div",{class:"stat-label"},"æ€»æ–‡ç« æ•°",-1))])])]),_:1}),e(n,{class:"stat-card"},{default:o(()=>[s("div",F,[s("div",H,[e(a,null,{default:o(()=>[e(p)]),_:1})]),s("div",I,[s("div",Q,v(r.value.totalComments),1),t[5]||(t[5]=s("div",{class:"stat-label"},"æ€»è¯„è®ºæ•°",-1))])])]),_:1}),e(n,{class:"stat-card"},{default:o(()=>[s("div",G,[s("div",J,[e(a,null,{default:o(()=>[e(y)]),_:1})]),s("div",K,[s("div",O,v(r.value.todayUsers),1),t[6]||(t[6]=s("div",{class:"stat-label"},"ä»Šæ—¥æ³¨å†Œ",-1))])])]),_:1})]),e(n,{class:"quick-actions"},{header:o(()=>[...t[7]||(t[7]=[s("div",{class:"card-header"},[s("span",null,"å¿«é€Ÿæ“ä½œ")],-1)])]),default:o(()=>[s("div",W,[e(i,{type:"primary",onClick:t[0]||(t[0]=m=>c.$router.push("/users"))},{default:o(()=>[e(a,null,{default:o(()=>[e(u)]),_:1}),t[8]||(t[8]=b(" ç”¨æˆ·ç®¡ç† ",-1))]),_:1}),e(i,{type:"primary",onClick:t[1]||(t[1]=m=>c.$router.push("/posts"))},{default:o(()=>[e(a,null,{default:o(()=>[e(_)]),_:1}),t[9]||(t[9]=b(" æ–‡ç« ç®¡ç† ",-1))]),_:1}),e(i,{type:"primary",onClick:t[2]||(t[2]=m=>c.$router.push("/comments"))},{default:o(()=>[e(a,null,{default:o(()=>[e(p)]),_:1}),t[10]||(t[10]=b(" è¯„è®ºç®¡ç† ",-1))]),_:1})])]),_:1}),e(n,{class:"recent-activity"},{header:o(()=>[...t[11]||(t[11]=[s("div",{class:"card-header"},[s("span",null,"æœ€è¿‘æ´»åŠ¨")],-1)])]),default:o(()=>[e($,{data:l.value,style:{width:"100%"}},{default:o(()=>[e(D,{prop:"type",label:"ç±»å‹",width:"100"},{default:o(({row:m})=>[e(C,{type:g(m.type)},{default:o(()=>[b(v(m.type),1)]),_:2},1032,["type"])]),_:1}),e(D,{prop:"description",label:"æè¿°"}),e(D,{prop:"time",label:"æ—¶é—´",width:"180"})]),_:1},8,["data"])]),_:1})])}}},at=k(X,[["__scopeId","data-v-18b8c720"]]);export{at as default};
